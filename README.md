#Tredou诞生记
####导语
>Tredou是我利用业务时间做的第一款iOS作品，灵感来源于WorkFlowy。我希望能够把笔记本的线性输入和思维导图的多维输出结合起来，帮助用户在移动端管理自己的想法。  

#####Gif演示(有可能加载较慢，可以先往下看)
![](http://checkitnow-photo.stor.sinaapp.com/Tredou展示视频480.gif)


##一、用户需求分析

* 当一个人遇到复杂的问题时，会用发散型思维去对问题进行剖析。由立体到面，由面到线，再由线到点。在细化得足够深后，往往复杂的问题都能被拆解为若干个简单问题。  
* 目前在移动端的记事类应用，受空间和使用场景的制约，普遍采用线性的输入方式。一来这样符合人脑传统的思维习惯，二来也有助于用户在一个维度上进行深度思考。
* 简单总结：面对复杂问题，梳理想法是实际存在的需求。通过结合线性的输入方式和多维的内容输出可否让管理想法的体验变得更好？

##二、功能设计
>目前产品处于需求验证阶段，所以我想先做出MVP产品。仅提供最简单的输入、跳转、输出的功能，根据反馈再来调整功能。

###1.输入
* 移动端的输入场景是碎片化的，与此同时屏幕的空间有限。若要给用户提供沉浸式的输入体验就必须减少其他因素对内容输入的干扰。
* 把文本输入和层级逻辑分离，输入时只需关注当前层级内容。
* 避免导航栏、键盘对输入内容的遮挡，要求即点即输。吧

###2.跳转
* 跳转是内容架构的构建方式。
* 可以在每条文本下无限层级创建子文本。
* 可以在各层级间跳转，从当前文本回到祖先文本。

###3.输出
* 可以在任意层级查看当前层级及所有子层级的内容。
* 内容展示上要体现文本之间的层级关系。
* 可以在输出视图中进行点击任意文本并跳转到该文本所在层级。

##三、交互及视觉设计
>输入和跳转的模式都是比较清晰的，开始策划时已经有了大概的模型，真正的难题是输出，遇到了一些取舍的难题。

###1.图标  
>* 希望图标可以展示app可以无限创建层级的特点，所以使用三行缩进文本来展示。
* 紫色是冷色调，意味着客观冷静的分析。（其实只是因为我妹子喜欢这个颜色。。）  
* 图标见下图  

![](http://checkitnow-photo.stor.sinaapp.com/Tredou图标.png)  



###2.Loading Page  
>* 素材源自UnSplash。 

![](http://checkitnow-photo.stor.sinaapp.com/loadingpage.png)  

###3.输入页、跳转（输入和输出）
>* 这两个都是输入输入流程，所以在一起讲。  
 * 点击右上角输入图标即可自动弹出键盘进行输入。
 * 每块文本的左边都会带有一个银灰的圆圈标记，如果是实心，意味着该文本下面有子层级。如果是空心，意味着下面没有。点击该标记即可进入子文本进行创建、编辑、删除。
 * 中间的导航条是用于跳转，自动截取父文本的前五个字作为提示，点击即可跳转到对应的文本。支持跨级跳转。

![](http://checkitnow-photo.stor.sinaapp.com/输入2.png)
  
###4.输出页（整体展示内容的层级关系）
>* 输出的展示我考虑过两种形式，见下图。
* 下左方的形式：优点是内容缩进清晰地展示了层级关系，但是缺点是因随着层级的加深，内容的展示空间越来越少。如果是内容多的话可读性就很差。
* 下右方的形式：优点是不管是哪个层级，内容展示都非常清晰。但是层级关系不明显，我试图用不同颜色的麻将牌来展示层级，如一筒就是第一层级，而二筒就是一筒的子层级。但是从身边人的反馈看，这种展示的学习成本太高，而且也不直观。
* 最后我采用了的是下左方布局，因为这款app的目标是帮助用户梳理想法，一个清晰的全局视角是非常必要的。至于层级加深后的文字显示不全问题，我限制了文本的显示高度，最多展示三行的内容。超过三行后，会自动省略剩余文本。可以点击文本跳转到详情页去查看内容。

![](http://checkitnow-photo.stor.sinaapp.com/输出1.png)   ![](http://checkitnow-photo.stor.sinaapp.com/输出2.png)


##四、开发笔记
>* 开发方面，遇到的坑太多了。印象最深的是以下两个难题。

### 1、数据结构的设计
#####1.1数据项元素
* 每个item即为一个字典，包括id、Parent_id、text三个字段。
* 整体数据即为字典的数组，类型为[[String:NSObject]]  
  `["id":1,"pid":0,"text":"从这里开始"]`  

####1.2数据处理
* 查找：根据parentid，遍历数组，找到所有parent_id为查找值的数据。
* 删除：根据id，遍历数组，删除后遍历数组，取出所有pid等于id的item，删除。然后递归直至不再有子项。
* 编辑：遍历数组，找到id为所需编辑项的id，更新字典值即可。
* 增加：整个数据结构需另外设置id值。使id值与数据保持同步，新增则取出id并加一然后作为新item的id值存入数组。  
 


###2.UITextView避免遮挡  

####2.1开始编辑时判断
* 首先给ViewController加个观察器，监视键盘，若键盘弹出，则取出键盘所占高度值。
* 取当前textview左上角所在的坐标，判断该坐标是否在遮挡区域内。
* 使用scrollRectToVisable来移动整块。

####2.2输入换行时判断
* 把tableview声明为textview的代理，然后使用textViewDidChange方法对换行情况进行判断
* 同样是判断textview是否被挡住，然后计算遮挡的值。
* 调整contentInset值来移动textview


